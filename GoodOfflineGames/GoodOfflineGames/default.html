<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>GOG.com collection</title>
    <meta name="viewport" content="width=device-width" />
    <style>
        * {
            font-family: -apple-system, "Segoe UI";
            font-size: 15px;
            box-sizing: border-box;
            margin: 0;
        }

        .background.dark {
            background: #212121;
        }

        .background.light {
            background: #f5f5f5;
        }

        body {
            padding: 1em;
        }

        a {
            text-decoration: none;
        }

        .dark a {
            color: white;
        }

        .light a {
            color: black;
        }

        button {
            display: block;
            color: inherit;
            border: 0;
            background: inherit;
            padding: 0.5em 1em;
            cursor: pointer;
            height: 3em;
        }

        .dark button {
            color: white;
        }

        .light button {
            color: black;
        }

        .dark button:hover {
            background: #1976d2;
        }

        .light button:hover {
            background: #2196f3;
        }

        .hidden {
            display: none !important;
        }

        .container {
            width: 100%;
            height: 100%;
            background: inherit;
            cursor: default;
        }

        #productsContainer,
        #searchResults {
            padding-top: 1em;
        }

        .dark .product {
            color: #B0BEC5;
        }

        .light .product {
            color: #212121;
        }

        .product {
            line-height: 2em;
            height: 2em;
            margin-right: 2em;
            display: inline-block;
        }

        .productContainer {
            display: inline-block;
            vertical-align: top;
            margin-right: 1em;
            margin-bottom: 1em;
        }

        .wishlisted {
            font-style: italic;
        }

        .dark .wishlisted {
            color: #FFC107 !important;
        }

        .light .wishlisted {
            color: #f57c00 !important;
        }

        .dark .owned {
            color: #4CAF50 !important;
        }

        .light .owned {
            color: #388e3c !important;
        }

        .partOwned {
            font-style: italic;
        }

        .dark .partOwned {
            color: #A5D6A7;
        }

        .light .partOwned {
            color: #66bb6a;
        }

        .bundle {
            font-weight: 600;
        }

            .bundle.owned {
                color: #388E3C;
            }

            .bundle.wishlisted {
                /* wishlisted bundle should be normal to distinguish with partial owned */
                color: #FF8F00 !important;
                font-style: normal;
            }

        .updated::after {
            content: "*";
            margin-left: 0.1em;
            color: #F44336;
        }

        .dark .dlc {
            color: #9FA8DA;
        }

        .light .dlc {
            color: #283593;
        }

        .dlc::after {
            content: "DLC";
            background: #9C27B0;
            border-radius: 0.2em;
            padding: 0 0.25em;
            margin-left: 0.25em;
            font-size: 0.8em;
            color: white !important;
        }

        .icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            margin-right: 0.5em;
            transform: translateY(0.125em);
        }

        .dark #gameDetailsContainer {
            color: #B0BEC5;
        }

        .light #gameDetailsContainer {
            color: #212121;
        }


        #gameDetailsContainer .descriptionContainer {
            margin-bottom: 1em;
        }

        #gameDetailsContainer .productContainer {
            margin-bottom: 0;
        }

        /* Top level page header shouldn't have top margin */
        #gameDetailsContainer > .productContainer > .productTitle.header1 {
            margin-top: 0;
        }

        .dark #gameDetailsContainer .cdKey {
            color: #212121 !important;
        }

        .light #gameDetailsContainer .cdKey {
            color: #f5f5f5 !important;
        }

        #gameDetailsContainer .cdKey:focus {
            background: inherit;
        }

        #gameDetailsContainer img {
            width: 100%;
            border: 0;
            display: inline-block;
            margin-bottom: 1em;
            margin-right: 1em;
            max-width: 800px;
            vertical-align: top;
        }

        #gameDetailsContainer .header1 {
            font-size: 2.25em;
            font-weight: 300;
            margin-top: 0.5em;
            margin-bottom: 0.5em;
        }

            #gameDetailsContainer .header1.bundle {
                font-weight: normal;
            }

        #gameDetailsContainer .filesContainer {
            margin-bottom: 1em;
            line-height: 2em;
        }

            #gameDetailsContainer .filesContainer h1 {
                font-size: 1.25em;
                font-weight: lighter;
                margin: 0.5em 0;
            }

            #gameDetailsContainer .filesContainer .entry {
                display: inline-block;
                margin-right: 2em;
            }

        #gameDetailsContainer .screenshotsContainer {
            margin-bottom: 1em;
        }

            #gameDetailsContainer .screenshotsContainer a {
                font-weight: 600;
            }

            #gameDetailsContainer .screenshotsContainer .screenshots {
                margin-top: 1em;
                text-align: center;
            }

            #gameDetailsContainer .screenshotsContainer .showScreenshots {
                border-left: 2px solid;
            }

        .dark #gameDetailsContainer .screenshotsContainer .showScreenshots {
            border-color: #1976d2;
        }

        .light #gameDetailsContainer .screenshotsContainer .showScreenshots {
            border-color: #2196f3;
        }

        #gameDetailsContainer tr {
            line-height: 2em;
        }

        #gameDetailsContainer td.header {
            line-height: 1.5em;
            padding-right: 0.75em;
            min-width: 5em;
        }

        .dark #gameDetailsContainer td.title {
            color: white;
        }

        .light #gameDetailsContainer td.title {
            color: black;
        }

        #infoContainer {
            padding: 1em;
        }

            #infoContainer .info {
                line-height: 2em;
                height: 2em;
            }

            #infoContainer .product {
                display: inline-block;
                cursor: default;
            }

            #infoContainer .count {
                float: right;
                margin-right: 0;
            }

        #toggleMenu {
            position: fixed;
            right: 0;
            top: 0;
            padding-right: 0.5em;
        }

        input[type=search] {
            padding: 4px;
            height: 30px;
            width: 200px;
            font-size: 0.8em;
            color: #212121;
            border: 0;
            /* WebKit insists that you can't change height of input type=search*/
            -webkit-appearance: none;
        }

            input[type=search]:focus {
                background-color: #e3f2fd;
                outline: 2px solid #2196f3;
            }

        #showAllSearchResults {
            margin-left: 0.5em;
            font-size: 0.8em;
        }

        #menuContainer {
            position: fixed;
            overflow: auto;
            top: 0;
            right: 0;
            bottom: 0;
            width: 300px;
            padding: 0;
            padding-top: 3em;
        }

            #menuContainer button {
                width: 100%;
                text-align: left;
            }

        *[accessKey] {
            position: relative;
        }

        .mnemonic {
            position: absolute;
            left: 0px;
            top: 0px;
            padding: 0.25em 0.5em;
            color: black;
            background: #ffc107;
            text-transform: uppercase;
            font-size: 0.6em;
            font-weight: bolder;
            z-index: 1;
        }

        .dark #errorMessage {
            color: white;
        }

        .light #errorMessage {
            color: black;
        }

        #errorMessage {
            font-size: 3em;
            text-align: center;
            margin: 1em;
        }

            #errorMessage #hal {
                width: 300px;
                height: 300px;
            }

            #errorMessage .note {
                font-size: 0.5em;
            }

        /* SVG */

        .dark #icons #Mac #mac-background {
            stroke: white;
        }

        .light #icons #Mac #mac-background {
            stroke: black;
        }

        .dark #icons #Mac #mac-foreground {
            stroke: black;
        }

        .light #icons #Mac #mac-foreground {
            stroke: white;
        }

        .dark #icons #Linux #linux-foreground {
            fill: black;
        }

        .light #icons #Linux #linux-foreground {
            fill: white;
        }

        .dark #icons #Windows,
        .dark #icons #Mac #mac-background,
        .dark #icons #Linux #linux-background,
        .dark #icons #top,
        .dark #icons #info,
        .dark #icons #back,
        .dark #icons #theme,
        .dark #icons #menu {
            fill: white;
        }

        .light #icons #Windows,
        .light #icons #Mac #mac-background,
        .light #icons #Linux #linux-background,
        .light #icons #top,
        .light #icons #info,
        .light #icons #back,
        .light #icons #theme,
        .light #icons #menu {
            fill: black;
        }
    </style>
</head>
<!-- switch themes on the body: dark, light -->
<body class="background dark">

    <svg id="icons" viewBox="0 0 100 100" class="hidden">
        <g id="Windows" transform="translate(0,-952.36216)">
            <g transform="matrix(2.6923075,0,0,2.6923075,-691.46883,403.20481)">
                <path d="m 272.05451,223.57098 -15.22321,0 0,12.43304 15.22321,2.09821 0,-14.53125 z m 0,-16.58482 -15.22321,2.09821 0,12.61161 15.22321,0 0,-14.70982 z m 21.91965,16.58482 -20.24554,0 0,14.75446 20.24554,2.79018 0,-17.54464 z m 0,-19.59821 -20.24554,2.79017 0,14.93304 20.24554,0 0,-17.72321 z" />
            </g>
        </g>
        <g id="Mac" transform="matrix(1.6666667,0,0,1.6666667,-33.333333,-33.333333)">
            <path id="mac-background" d="M 50,79 C 34,79 21,66 21,50 21,34 34,21 50,21 66,21 79,34 79,50 79,66 66,79 50,79 Z" />
            <path id="mac-foreground" stroke="black" stroke-width="2px" d="m 62.8,31.6 c -0.2,-0.2 -0.5,-0.1 -0.7,0.1 L 50,49.1 37.9,31.7 c -0.2,-0.2 -0.5,-0.3 -0.7,-0.1 -0.2,0.2 -0.3,0.5 -0.1,0.7 L 49.4,50 37.1,67.7 c -0.2,0.2 -0.1,0.5 0.1,0.7 0.1,0.1 0.2,0.1 0.3,0.1 0.2,0 0.3,-0.1 0.4,-0.2 L 50,50.9 62.1,68.3 c 0.1,0.1 0.3,0.2 0.4,0.2 0.1,0 0.2,0 0.3,-0.1 0.2,-0.2 0.3,-0.5 0.1,-0.7 L 50.6,50 62.9,32.3 c 0.2,-0.2 0.1,-0.6 -0.1,-0.7 z" />
        </g>
        <g id="Linux" transform="matrix(1.1111076,0,0,1.1111111,-5.555385,-5.555555)">
            <path id="linux-background" d="M 95.00015,50.000432 C 95.00015,74.852315 74.852463,95 49.999138,95 25.146388,95 4.9998625,74.852315 4.9998625,50.000432 c 0,-24.853612 20.1465255,-45.0004322 44.9992755,-45.0004322 24.853325,0 45.001012,20.1468202 45.001012,45.0004322" />
            <path id="linux-foreground" d="m 62.295912,28.701087 c 2.873376,1.659372 6.546563,0.675122 8.204788,-2.197388 1.659075,-2.873664 0.675688,-6.546562 -2.197975,-8.205644 -2.873087,-1.658504 -6.545987,-0.674543 -8.205062,2.199121 -1.6585,2.872509 -0.67455,6.545408 2.19825,8.203911 z M 50,67.549813 c -2.641888,0 -5.145512,-0.587374 -7.392837,-1.632816 l -4.174551,7.480879 C 41.919625,75.124499 45.845375,76.10009 50,76.10009 c 2.416175,0 4.7524,-0.334819 6.9726,-0.949614 0.392825,-2.413 1.825625,-4.636944 4.109888,-5.956013 2.280224,-1.316469 4.919225,-1.446933 7.203499,-0.583622 4.4424,-4.368222 7.333101,-10.311246 7.753925,-16.929679 l -8.5624,-0.124687 C 66.689537,60.521517 59.168538,67.549813 50,67.549813 Z m 0,-35.099916 c 9.168538,0 16.689537,7.029739 17.477512,15.993631 l 8.5624,-0.124975 C 75.6185,41.700699 72.727812,35.757675 68.284837,31.389741 66.00085,32.252475 63.362137,32.121722 61.081625,30.804963 58.797637,29.486472 57.365137,27.262817 56.972312,24.849528 54.7524,24.235311 52.416175,23.900204 50,23.900204 c -4.154625,0 -8.080075,0.975302 -11.566813,2.702502 l 4.174263,7.480012 C 44.854487,33.037277 47.358112,32.449902 50,32.449902 Z M 32.450338,49.999856 c 0,-5.93754 2.950725,-11.181774 7.4624,-14.357351 l -4.392175,-7.357919 c -5.257513,3.512993 -9.168825,8.882784 -10.793275,15.172749 1.897787,1.546802 3.11035,3.902363 3.11035,6.543097 0,2.640447 -1.21285,4.996008 -3.110638,6.542522 1.624163,6.290252 5.535475,11.660045 10.793275,15.173037 l 4.392463,-7.358207 c -4.511675,-3.175289 -7.4624,-8.419523 -7.4624,-14.357928 z m 29.84645,21.298479 c -2.873675,1.659081 -3.857625,5.331691 -2.198838,8.2042 1.659088,2.873663 5.331688,3.858202 8.20535,2.199121 2.8728,-1.658794 3.85705,-5.331691 2.197975,-8.205066 -1.658512,-2.872221 -5.3317,-3.85676 -8.204487,-2.198255 z M 19.400513,43.992755 c -3.31875,0 -6.007975,2.688936 -6.007975,6.007677 0,3.317876 2.689225,6.007102 6.007975,6.007102 3.317587,0 6.0071,-2.689226 6.0071,-6.007102 0,-3.318741 -2.689513,-6.007677 -6.0071,-6.007677" />
        </g>
        <g id="top" transform="translate(0,-952.36216)">
            <path d="m 99.999997,1023.2041 c 0,-0.8016 -0.400802,-1.7034 -1.002004,-2.3046 L 52.304607,974.20607 c -0.601202,-0.6012 -1.503006,-1.002 -2.304609,-1.002 -0.801603,0 -1.703406,0.4008 -2.304609,1.002 L 1.0020039,1020.8995 c -0.60120243,0.6012 -1.00200401920929,1.503 -1.00200401920929,2.3046 0,0.8016 0.40080158920929,1.7034 1.00200401920929,2.3046 l 5.0100198,5.01 c 0.6012024,0.6012 1.503006,1.002 2.3046092,1.002 0.8016032,0 1.7034071,-0.4008 2.3046091,-1.002 l 39.378756,-39.37876 39.378757,39.37876 c 0.601202,0.6012 1.503006,1.002 2.304609,1.002 0.901803,0 1.703406,-0.4008 2.304609,-1.002 l 5.01002,-5.01 c 0.601202,-0.6012 1.002004,-1.503 1.002004,-2.3046 z" />
        </g>
        <g id="info" transform="translate(0,-952.36216)">
            <path d="m 66.644972,1033.6182 c 0,1.1715 -0.911162,2.0827 -2.082656,2.0827 l -29.157175,0 c -1.171493,0 -2.082655,-0.9112 -2.082655,-2.0827 l 0,-10.4133 c 0,-1.1715 0.911162,-2.0826 2.082655,-2.0826 l 6.247966,0 0,-20.8266 -6.247966,0 c -1.171493,0 -2.082655,-0.91113 -2.082655,-2.08262 l 0,-10.41328 c 0,-1.17149 0.911162,-2.08266 2.082655,-2.08266 l 20.826554,0 c 1.171493,0 2.082655,0.91117 2.082655,2.08266 l 0,33.3225 6.247966,0 c 1.171494,0 2.082656,0.9111 2.082656,2.0826 l 0,10.4133 z M 58.31435,975.30387 c 0,1.17149 -0.911162,2.08265 -2.082655,2.08265 l -12.495932,0 c -1.171494,0 -2.082656,-0.91116 -2.082656,-2.08265 l 0,-10.41328 c 0,-1.17149 0.911162,-2.08265 2.082656,-2.08265 l 12.495932,0 c 1.171493,0 2.082655,0.91116 2.082655,2.08265 l 0,10.41328 z m 41.653107,27.07453 c 0,-27.5952 -22.388545,-49.98374 -49.983728,-49.98374 C 22.388545,952.39466 0,974.7832 0,1002.3784 c 0,27.5952 22.388545,49.9837 49.983729,49.9837 27.595183,0 49.983728,-22.3885 49.983728,-49.9837 z" />
        </g>
        <g id="theme">
            <path xmlns="http://www.w3.org/2000/svg" d="M 50 8.333 c 23.012 0 41.667 18.655 41.667 41.667 S 73.012 91.667 50 91.667 S 8.333 73.012 8.333 50 S 26.988 8.333 50 8.333 Z M 50 0 C 22.385 0 0 22.385 0 50 s 22.385 50 50 50 s 50 -22.385 50 -50 S 77.615 0 50 0 Z M 50 5.583 C 50 5.583 5.583 7.167 5.583 50 S 50 94.417 50 94.417 S 30.25 82.083 30.25 50 S 50 5.583 50 5.583 Z" />
        </g>
        <g id="menu">
            <rect x="5" y="13" width="90" height="13" />
            <rect x="5" y="73" width="90" height="13" />
            <rect x="5" y="43" width="90" height="13" />
        </g>
        <g id="hal9000" transform="translate(0,-796.36218)">
            <defs>
                <linearGradient id="linearGradient4716">
                    <stop id="stop4718"
                          style="stop-color:#0a1314;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4720"
                          style="stop-color:#0a1314;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient4698">
                    <stop id="stop4700"
                          style="stop-color:#424a4b;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4702"
                          style="stop-color:#424a4b;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient4680">
                    <stop id="stop4682"
                          style="stop-color:#0e191c;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4684"
                          style="stop-color:#0e191c;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient4662">
                    <stop id="stop4664"
                          style="stop-color:#f5f4f1;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4666"
                          style="stop-color:#f5f4f1;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient4632">
                    <stop id="stop4634"
                          style="stop-color:#626463;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4636"
                          style="stop-color:#626463;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient4622">
                    <stop id="stop4624"
                          style="stop-color:#b9b5b4;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4626"
                          style="stop-color:#9d9290;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient4594">
                    <stop id="stop4596"
                          style="stop-color:#473e3e;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4598"
                          style="stop-color:#473e3e;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient4584">
                    <stop id="stop4586"
                          style="stop-color:#b1aba9;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4588"
                          style="stop-color:#b1aba9;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient4572">
                    <stop id="stop4574"
                          style="stop-color:#e0d8d4;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4580"
                          style="stop-color:#e0d8d4;stop-opacity:0.45490196"
                          offset="0.67647064" />
                    <stop id="stop4576"
                          style="stop-color:#e0d8d4;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient4562">
                    <stop id="stop4564"
                          style="stop-color:#cfcdc7;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4566"
                          style="stop-color:#cfcdc7;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient4546">
                    <stop id="stop4548"
                          style="stop-color:#444544;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4550"
                          style="stop-color:#706062;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient4454">
                    <stop id="stop4456"
                          style="stop-color:#bebbb6;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4458"
                          style="stop-color:#bebbb6;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient4446">
                    <stop id="stop4448"
                          style="stop-color:#8f908a;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4450"
                          style="stop-color:#8f908a;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient4438">
                    <stop id="stop4440"
                          style="stop-color:#ffffff;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4442"
                          style="stop-color:#ffffff;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient4430">
                    <stop id="stop4432"
                          style="stop-color:#ea3231;stop-opacity:1"
                          offset="0" />
                    <stop id="stop4434"
                          style="stop-color:#ea3231;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient3971">
                    <stop id="stop3973"
                          style="stop-color:#ea1117;stop-opacity:1"
                          offset="0" />
                    <stop id="stop3975"
                          style="stop-color:#d3070e;stop-opacity:1"
                          offset="0.36951563" />
                    <stop id="stop3977"
                          style="stop-color:#c10914;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient3862">
                    <stop id="stop3864"
                          style="stop-color:#ea1117;stop-opacity:1"
                          offset="0" />
                    <stop id="stop3866"
                          style="stop-color:#ea1117;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient3798">
                    <stop id="stop3800"
                          style="stop-color:#f8ee46;stop-opacity:1"
                          offset="0" />
                    <stop id="stop3802"
                          style="stop-color:#d3321c;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <linearGradient id="linearGradient3774">
                    <stop id="stop3776"
                          style="stop-color:#ea1117;stop-opacity:1"
                          offset="0" />
                    <stop id="stop3782"
                          style="stop-color:#cd0d14;stop-opacity:1"
                          offset="0.36951563" />
                    <stop id="stop3778"
                          style="stop-color:#c10914;stop-opacity:0"
                          offset="1" />
                </linearGradient>
                <filter color-interpolation-filters="sRGB"
                        id="filter4426">
                    <feGaussianBlur id="feGaussianBlur4428"
                                    stdDeviation="0.79644532" />
                </filter>
                <filter x="-0.014859335"
                        y="-0.10673607"
                        width="1.0297188"
                        height="1.2134721"
                        color-interpolation-filters="sRGB"
                        id="filter4487">
                    <feGaussianBlur id="feGaussianBlur4489"
                                    stdDeviation="0.49337636" />
                </filter>
                <filter color-interpolation-filters="sRGB"
                        id="filter4511">
                    <feGaussianBlur id="feGaussianBlur4513"
                                    stdDeviation="0.36832783" />
                </filter>
                <radialGradient cx="355.6181"
                                cy="263.47437"
                                r="214.64285"
                                fx="355.6181"
                                fy="263.47437"
                                id="radialGradient4735"
                                xlink:href="#linearGradient4662"
                                gradientUnits="userSpaceOnUse"
                                gradientTransform="matrix(0.49590542,0.02361451,-0.04756507,0.99886814,191.79733,-8.0995301)" />
                <radialGradient cx="688.20172"
                                cy="322.61343"
                                r="214.64285"
                                fx="688.20172"
                                fy="322.61343"
                                id="radialGradient4737"
                                xlink:href="#linearGradient4662"
                                gradientUnits="userSpaceOnUse"
                                gradientTransform="matrix(0.18891652,0.20859515,-0.74120407,0.67127976,623.54686,-26.528142)" />
                <radialGradient cx="-50.826534"
                                cy="568.55469"
                                r="214.64285"
                                fx="-50.826534"
                                fy="568.55469"
                                id="radialGradient4739"
                                xlink:href="#linearGradient4662"
                                gradientUnits="userSpaceOnUse"
                                gradientTransform="matrix(0.24198071,-0.24251704,0.72109578,0.71950102,-205.95295,-86.121137)" />
                <radialGradient cx="143.2925"
                                cy="560.57587"
                                r="214.64285"
                                fx="143.2925"
                                fy="560.57587"
                                id="radialGradient4741"
                                xlink:href="#linearGradient4680"
                                gradientUnits="userSpaceOnUse"
                                gradientTransform="matrix(0.55737084,1.1227092,-1.0153425,0.5040684,651.47245,105.56632)" />
                <radialGradient cx="359.53653"
                                cy="680.74078"
                                r="214.64285"
                                fx="359.53653"
                                fy="680.74078"
                                id="radialGradient4743"
                                xlink:href="#linearGradient4698"
                                gradientUnits="userSpaceOnUse"
                                gradientTransform="matrix(0.59429926,-0.0196788,0.03309447,0.99945223,124.48576,7.5040537)" />
                <radialGradient cx="549.07318"
                                cy="531.27026"
                                r="214.64285"
                                fx="549.07318"
                                fy="531.27026"
                                id="radialGradient4745"
                                xlink:href="#linearGradient4716"
                                gradientUnits="userSpaceOnUse"
                                gradientTransform="matrix(-0.28951144,0.61897854,-1.0261698,-0.47996685,1253.2096,446.39787)" />
                <radialGradient cx="137.3555"
                                cy="130.31177"
                                r="87.547356"
                                fx="137.3555"
                                fy="130.31177"
                                id="radialGradient4965"
                                xlink:href="#linearGradient3774"
                                gradientUnits="userSpaceOnUse" />
                <radialGradient cx="137.3555"
                                cy="130.31177"
                                r="87.547356"
                                fx="137.3555"
                                fy="130.31177"
                                id="radialGradient4967"
                                xlink:href="#linearGradient3971"
                                gradientUnits="userSpaceOnUse" />
                <radialGradient cx="126.875"
                                cy="125.125"
                                r="44.125"
                                fx="126.875"
                                fy="125.125"
                                id="radialGradient4969"
                                xlink:href="#linearGradient3862"
                                gradientUnits="userSpaceOnUse" />
                <radialGradient cx="493.20697"
                                cy="120.2355"
                                r="20.152544"
                                fx="493.20697"
                                fy="120.2355"
                                id="radialGradient4971"
                                xlink:href="#linearGradient3798"
                                gradientUnits="userSpaceOnUse"
                                gradientTransform="matrix(0.75621888,0,0,0.75621888,120.23455,29.311144)" />
                <linearGradient x1="59.75"
                                y1="853.86218"
                                x2="63.5"
                                y2="848.86218"
                                id="linearGradient4973"
                                xlink:href="#linearGradient4454"
                                gradientUnits="userSpaceOnUse" />
                <linearGradient x1="65.5"
                                y1="878.36218"
                                x2="89"
                                y2="879.86218"
                                id="linearGradient4975"
                                xlink:href="#linearGradient4438"
                                gradientUnits="userSpaceOnUse" />
                <linearGradient x1="159.09903"
                                y1="895.73804"
                                x2="155.03316"
                                y2="895.2077"
                                id="linearGradient4977"
                                xlink:href="#linearGradient4430"
                                gradientUnits="userSpaceOnUse" />
                <linearGradient x1="201.5"
                                y1="859.36218"
                                x2="192.5"
                                y2="865.86218"
                                id="linearGradient4979"
                                xlink:href="#linearGradient4446"
                                gradientUnits="userSpaceOnUse" />
                <radialGradient cx="565.67145"
                                cy="446.36511"
                                r="214.64285"
                                fx="565.67145"
                                fy="446.36511"
                                id="radialGradient4981"
                                xlink:href="#linearGradient4546"
                                gradientUnits="userSpaceOnUse"
                                gradientTransform="matrix(-0.01141222,0.7200172,-0.98807046,-0.01566569,1003.895,64.801116)" />
                <radialGradient cx="525.8512"
                                cy="583.23352"
                                r="214.64285"
                                fx="525.8512"
                                fy="583.23352"
                                id="radialGradient4983"
                                xlink:href="#linearGradient4562"
                                gradientUnits="userSpaceOnUse"
                                gradientTransform="matrix(-0.13019845,0.14665728,-0.25941753,-0.23030421,735.49435,657.5781)" />
                <radialGradient cx="338.53104"
                                cy="703.86841"
                                r="214.64285"
                                fx="338.53104"
                                fy="703.86841"
                                id="radialGradient4985"
                                xlink:href="#linearGradient4572"
                                gradientUnits="userSpaceOnUse"
                                gradientTransform="matrix(-0.27995439,0.0091529,-0.01235873,-0.37800452,464.47395,950.87477)" />
                <radialGradient cx="241.97748"
                                cy="591.31604"
                                r="214.64285"
                                fx="241.97748"
                                fy="591.31604"
                                id="radialGradient4987"
                                xlink:href="#linearGradient4584"
                                gradientUnits="userSpaceOnUse"
                                gradientTransform="matrix(0.0653018,0.07876991,-0.51364189,0.42581899,480.05196,325.10195)" />
                <radialGradient cx="148.8054"
                                cy="479.24811"
                                r="214.64285"
                                fx="148.8054"
                                fy="479.24811"
                                id="radialGradient4989"
                                xlink:href="#linearGradient4594"
                                gradientUnits="userSpaceOnUse"
                                gradientTransform="matrix(0.03414964,0.69195514,-1.3162287,0.06495088,774.52389,345.15386)" />
                <radialGradient cx="361.88593"
                                cy="270.58835"
                                r="214.64285"
                                fx="361.88593"
                                fy="270.58835"
                                id="radialGradient4991"
                                xlink:href="#linearGradient4622"
                                gradientUnits="userSpaceOnUse"
                                gradientTransform="matrix(0.50253939,0.0288342,-0.05728614,0.9983578,195.52495,-9.9903306)" />
                <radialGradient cx="113.19639"
                                cy="362.84845"
                                r="214.64285"
                                fx="113.19639"
                                fy="362.84845"
                                id="radialGradient4993"
                                xlink:href="#linearGradient4632"
                                gradientUnits="userSpaceOnUse"
                                gradientTransform="matrix(-0.08238352,0.11533689,-0.81373347,-0.58123819,490.52721,552.42839)" />
            </defs>
            <g transform="translate(-727,-21)">
                <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                      transform="matrix(0.59186864,0,0,0.59186864,645.52079,666.41997)"
                      style="fill:#5d5f5f;" />
                <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                      transform="matrix(0.59186864,0,0,0.59186864,645.52079,666.41997)"
                      style="fill:url(#radialGradient4735);" />
                <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                      transform="matrix(0.59186864,0,0,0.59186864,645.52079,666.41997)"
                      style="fill:url(#radialGradient4737);" />
                <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                      transform="matrix(0.59186864,0,0,0.59186864,645.52079,666.41997)"
                      style="fill:url(#radialGradient4739);" />
                <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                      transform="matrix(0.59186864,0,0,0.59186864,645.52079,666.41997)"
                      style="fill:url(#radialGradient4741);" />
                <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                      transform="matrix(0.59186864,0,0,0.59186864,645.52079,666.41997)"
                      style="fill:url(#radialGradient4743);" />
                <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                      transform="matrix(0.59186864,0,0,0.59186864,645.52079,666.41997)"
                      style="fill:url(#radialGradient4745);" />
            </g>
            <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                  transform="matrix(0.56551391,0,0,0.56551391,-72.151523,657.84071)"
                  style="fill:#706062;" />
            <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                  transform="matrix(0.56551391,0,0,0.56551391,-72.151523,657.84071)"
                  style="fill:#767676;" />
            <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                  transform="matrix(0.56551391,0,0,0.56551391,-72.151523,657.84071)"
                  style="fill:url(#radialGradient4981);" />
            <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                  transform="matrix(0.56551391,0,0,0.56551391,-72.151523,657.84071)"
                  style="fill:url(#radialGradient4983);" />
            <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                  transform="matrix(0.56551391,0,0,0.56551391,-72.151523,657.84071)"
                  style="fill:url(#radialGradient4985);" />
            <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                  transform="matrix(0.56551391,0,0,0.56551391,-72.151523,657.84071)"
                  style="fill:url(#radialGradient4987);" />
            <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                  transform="matrix(0.56551391,0,0,0.56551391,-72.151523,657.84071)"
                  style="fill:url(#radialGradient4989);" />
            <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                  transform="matrix(0.56551391,0,0,0.56551391,-72.151523,657.84071)"
                  style="fill:url(#radialGradient4991);" />
            <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                  transform="matrix(0.56551391,0,0,0.56551391,-72.151523,657.84071)"
                  style="fill:url(#radialGradient4993);" />
            <g transform="translate(-2.2167876e-7,-3.5831251e-6)">
                <path d="m 568.57141,471.29074 a 214.64285,214.64285 0 1 1 -429.2857,0 214.64285,214.64285 0 1 1 429.2857,0 z"
                      transform="matrix(0.51198087,0,0,0.51198087,-53.204651,683.07034)" />
                <path d="m 224.15285,130.31177 a 86.797356,86.797356 0 1 1 -173.594706,0 86.797356,86.797356 0 1 1 173.594706,0 z"
                      transform="matrix(0.74941633,0,0,0.74941633,25.063546,826.70441)"
                      style="opacity:0.38050316;fill:url(#radialGradient4965);" />
                <path d="m 224.15285,130.31177 a 86.797356,86.797356 0 1 1 -173.594706,0 86.797356,86.797356 0 1 1 173.594706,0 z"
                      transform="translate(-9.3554993,794.05041)"
                      style="fill:url(#radialGradient4967);" />
                <path d="m 170.25,125.125 a 43.375,43.375 0 1 1 -86.75,0 43.375,43.375 0 1 1 86.75,0 z"
                      transform="translate(1.125,801.23718)"
                      style="fill:url(#radialGradient4969);fill-opacity:1;stroke:#ef1d00;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:0;stroke-dasharray:none;stroke-dashoffset:0" />
                <path d="m 513.35951,120.2355 a 20.152544,20.152544 0 1 1 -40.30508,0 20.152544,20.152544 0 1 1 40.30508,0 z"
                      transform="matrix(1.6843175,0,0,1.6843175,-702.71713,721.84743)"
                      style="fill:url(#radialGradient4971);" />
                <path d="m 498.51029,117.9374 a 4.0658641,4.0658641 0 1 1 -8.13173,0 4.0658641,4.0658641 0 1 1 8.13173,0 z"
                      transform="matrix(0.86956522,0,0,0.86956522,-301.95168,821.80792)"
                      style="fill:#f4f846;" />
                <g style="filter:url(#filter4426)">
                    <path d="m 98.20252,833.52304 2.12132,8.3085 c 15.36068,-5.88046 45.97986,-3.83259 61.87184,3.71231 l 1.59099,-8.3085 C 143.78528,828.55429 112.399,829.1646 98.20252,833.52304 z"
                          style="fill:#c9c9bf;" />
                    <path d="m 58.60454,849.25616 c -13.04121,17.05062 -17.38118,27.71714 -19.09189,37.29989 3.26274,-1.56268 4.80687,-4.56751 6.34116,-7.26083 6.11733,-9.48606 12.36426,-19.07676 21.05923,-25.44286 z"
                          style="fill:url(#linearGradient4973);" />
                    <path d="m 58.60454,877.71721 11.3137,-8.3085 9.54595,9.36916 -10.78338,4.5962 z"
                          style="opacity:0.53773588;fill:url(#linearGradient4975);" />
                    <path d="m 111.10722,853.49881 c 9.39243,-1.29788 19.13002,-0.86996 28.99137,0.17677 0.56932,2.02341 0.78297,4.40249 0.88389,6.89429 -9.25131,-0.68705 -18.50263,-1.334 -27.75394,-0.17677 -0.425,-2.01599 -1.22929,-4.41128 -2.12132,-6.89429 z"
                          style="opacity:0.53773588;fill:#ffffff;" />
                    <path d="m 178.81269,871.17648 -5.12652,6.54073 c 2.70117,0.95519 6.19764,2.10921 10.78337,3.53554 1.18577,-1.42148 2.82121,-3.29262 4.94975,-5.65686 -2.93649,-1.67282 -6.26255,-3.21578 -10.6066,-4.41941 z"
                          style="fill:#816461;" />
                    <path d="m 91.66178,896.98587 5.12652,-3.88909 2.2981,3.53554 -3.88909,3.18198 z"
                          style="fill:#f15e4f;" />
                    <path d="m 118.88539,882.31341 c 5.81338,-0.94098 11.07456,-0.22537 16.44023,0.17677 l -0.35355,3.18198 c -5.24438,-0.1614 -10.48875,-0.5541 -15.73313,0.17678 z"
                          style="fill:#ec4e3e;" />
                    <path d="m 119.76927,895.21811 c 7.32697,-1.53523 13.82111,-1.00484 19.26866,2.12132 l 1.41422,-2.82843 c -7.72213,-3.49102 -16.3628,-3.26623 -21.38998,-1.59099 z"
                          style="fill:#e66044;" />
                    <path d="m 160.25114,898.75364 2.12132,-3.0052 -4.94975,-2.2981 -2.65165,2.2981 z"
                          style="fill:url(#linearGradient4977);" />
                    <path d="m 155.30139,906.70859 c -2.27582,-3.53407 -2.72679,-5.37411 -4.77297,-7.07107 l -1.59099,1.06066 c 2.46956,2.24316 4.48363,4.82793 6.01041,7.77818 z"
                          style="fill:#f74639;" />
                    <path d="m 132.4972,901.40529 c -2.88735,-0.75674 -5.77471,-0.58908 -8.66206,-0.17678 l 0,-1.94454 c 2.70228,-0.8158 5.54755,-0.77368 8.48528,-0.17678 z"
                          style="fill:#ef4d2b;" />
                    <path d="m 108.63234,900.52141 c -3.03319,2.75901 -5.03926,5.90318 -6.18718,9.36916 l -1.06066,-1.06066 c 1.17722,-3.76435 2.99712,-7.35399 6.0104,-10.42982 z"
                          style="fill:#eb5241;" />
                    <path d="m 110.57688,908.47636 1.06067,-2.47488 -2.65166,-1.06066 -1.23743,2.47488 z"
                          style="fill:#f7432e;" />
                    <path d="m 146.99288,908.29958 1.23744,-1.94454 -2.12132,-1.23744 -1.76777,1.41421 z"
                          style="fill:#f7432e;" />
                    <path d="m 191.57094,855.65046 4.77297,-4.06587 c 8.44599,4.49145 14.50078,13.36678 20.15255,22.98097 l -2.47488,2.47488 c -7.3081,-7.48088 -14.67726,-14.83965 -22.45064,-21.38998 z"
                          style="fill:url(#linearGradient4979);" />
                </g>
                <path d="m 128,26.25 c -12.15497,0 -23.81896,2.153186 -34.625,6.0625 l 2.34375,0.15625 C 105.86477,29.075845 116.71287,28.25 128,28.25 c 15.02248,0 29.28979,2.249441 42.125,8.09375 L 173.0625,36.75 C 159.47932,30.02936 144.18114,26.25 128,26.25 z"
                      transform="translate(0,796.36218)"
                      style="opacity:0.93081761;fill:#35373c;filter:url(#filter4487)" />
                <path d="M 49.71875,63 C 46.008058,67.46453 42.663152,72.251252 39.75,77.3125 l 0.1875,0.03125 c 1.24315,-2.050869 3.554075,-4.055585 4.931758,-6.00967 1.73058,-2.454631 3.566499,-5.829368 5.505742,-8.11533 z"
                      transform="translate(0,796.36218)"
                      style="opacity:0.39308178;fill:#bab7b2;filter:url(#filter4511)" />
            </g>
        </g>
    </svg>

    <div id="errorMessage" class="hidden">
        <svg id="hal" viewBox='0 0 300 300' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>
            <use xlink:href='#hal9000'></use>
        </svg>
        <br />
        I'm sorry, Dave. <br />I'm afraid I can't do that. <br /> <span class="note">Note: Please run the application at least once.</span>
    </div>

    <div id="searchContainer" accesskey="4">
        <input id="searchInput" type="search" placeholder="Type to search..." tabindex="0" accesskey="4" />
        <a id="showAllSearchResults" class="hidden" href="#showAll">+<span class="resultsCount"></span>...</a>
    </div>

    <div id="productsContainer" class="container hidden"></div>
    <div id="searchResults" class="container hidden"></div>

    <div id="gameDetailsContainer" class="container hidden"></div>

    <div id="menuContainer" class="container hidden">
        <button id="backToTop" title="Back to top" accesskey="t">
            <svg class="icon" viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>
                <use xlink:href='#top'></use>
            </svg>
            <span>Back to top</span>
        </button>
        <button id="toggleInfo" title="Information" accesskey="i">
            <svg class="icon" viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>
                <use xlink:href='#info'></use>
            </svg>
            <span>Information</span>
        </button>
        <div id="infoContainer" class="hidden"></div>
        <button id="switchTheme" title="Switch theme" accesskey="s">
            <svg class="icon" viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>
                <use xlink:href='#theme'></use>
            </svg>
            <span>Switch theme</span>
        </button>
    </div>

    <button id="toggleMenu" title="Menu" accesskey="m">
        <svg class="icon" viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>
            <title>Menu</title>
            <use xlink:href='#menu'></use>
        </svg>
    </button>

    <script>
        var products = undefined;
        var productsdata = undefined;
        var gamedetails = undefined;
        var owned = undefined;
        var updated = undefined;
        var bundles = undefined;
        var wishlisted = undefined;
        var screenshots = undefined;
        var productfiles = undefined;
        var wikipedia = undefined;
    </script>
    <script src="./products.js"></script>
    <script src="./owned.js"></script>
    <script src="./updated.js"></script>
    <script src="./wishlisted.js"></script>
    <script src="./productsdata.js"></script>
    <script src="./gamedetails.js"></script>
    <script src="./bundles.js"></script>
    <script src="./productfiles.js"></script>
    <script src="./screenshots.js"></script>
    <script src="./wikipedia.js"></script>
    <script>
        "use strict";

        var $ = function (id) { return document.getElementById(id); }
        var _$ = function (n, s) { return n.querySelector(s); }
        var $$ = function (s) { return document.querySelectorAll(s); }
        var _$$ = function (n, s) { return n.querySelectorAll(s); }

        var Templates = function () {
            var getProductTemplate = function () {
                return "<a class='product {{productClass}}' href='#{{id}}'>" +
                  "<span class='title' title='{{title}}' >{{title}}</span></a>";
            }
            var gameDetailsImageTemplate = "<img class='image {{productImageClass}}' srcset='{{productRetinaImage}} 2x, {{productImage}} 1x' src='{{productImage}}' onerror='Images.hideOnError(this)' />";
            var gameDetailsProductHeader = "<div class='productTitle header1 {{productClass}}'>{{productTitle}}</div>";
            var gameDetailsDescription = "<table border='0' cellspacing='0' cellpadding='0' class='descriptionContainer'>" +
                  "<tr class='{{developerClass}}'><td class='header'>Developer</td><td class='title'>{{developerTitle}}</td></tr>" +
                  "<tr class='{{publisherClass}}'><td class='header'>Publisher</td><td class='title'>{{publisherTitle}}</td></tr>" +
                  "<tr class='{{genresClass}}'><td class='header'>Genres</td><td class='title'>{{genresTitle}}</td></tr>" +
                  "<tr class='{{seriesClass}}'><td class='header'>Series</td><td class='title'>{{seriesTitle}}</td></tr>" +
                  "<tr class='{{cdKeyClass}}'><td class='header'>CD Key</td><td class='title cdKey' title='Select to reveal'>{{cdKeyTitle}}</td></tr>" +
                  "<tr class='{{requiredProductsClass}}'><td class='header'>Required products</td><td class='title'>{{requiredProductsTitle}}</td></tr>" +
                  "<tr class='{{worksOnClass}}'><td class='header'>Works on</td><td class='title worksOn'>{{worksOnTitle}}</td></tr>" +
                  "<tr class='{{wikiClass}}'><td class='header'>Wikipedia</td><td class='title'><a href={{wikiLink}} accesskey='w'>Article</a></td></tr>" +
                  "</table>";
            var gameDetailsFileContainer = "<div class='filesContainer {{filesClass}}'>" +
                  "<h1>Installers, patches</h1><div>{{installersContent}}</div>" +
                  "<div class='{{extrasClass}}'><h1>Extras</h1><div>{{extrasContent}}</div></div>";
            var gameDetailsScreenshotsContainer = "<div class='screenshotsContainer'>" +
                "<button accesskey='s' class='{{showScreenshotsClass}} showScreenshots' onclick='Screenshots.show(this);'>Show/hide {{screenshotsCount}} screenshots</button>" +
                "<div class='screenshots hidden'>{{screenshotsContent}}</div>" +
                "</div>";
            var getGameDetailsTemplate = function () {
                return "<div class='productContainer'>" +
                  gameDetailsProductHeader +
                  gameDetailsImageTemplate +
                  gameDetailsDescription +
                  gameDetailsScreenshotsContainer +
                  gameDetailsFileContainer +
                  "</div>";
            }
            var getDLCsTemplate = function () {
                return "<div class='dlcTitle header1 {{dlcClass}}'>Downloadable content</div>" +
                  "<div class='dlcContainer {{dlcClass}}'>{{dlcContent}}</div>";
            }
            var getBundleTemplate = function () {
                return "<div class='bundleTitle header1 {{bundleClass}}'>Bundled products</div>" +
                  "<div class='bundleContainer {{bundleClass}}'>{{bundleContent}}</div>";
            }
            var getRequiredProductTemplate = function () {
                return "<a href='#{{id}}'>{{title}}</a>"
            }
            var getFileInstallerTemplate = function () {
                return "<span class='file entry'><a href='./{{folder}}/{{file}}'>" +
                    getOperatingSystemIconTemplate() +
                    "<span class='linkText'>{{name}}, {{version}} {{size}}</span></a></span>";
            }
            var getFileExtraTemplate = function () {
                return "<span class='extra entry'><a href='./{{folder}}/{{file}}'>{{name}} {{size}}</a></span>";
            }
            var getScreenshotTemplate = function () {
                return "<a href='{{uri}}'><img data-src={{uri}} onerror='Images.hideOnError(this)'/></a>";
            }
            var getOperatingSystemIconTemplate = function () {
                return "<span class='icon'><svg viewBox='0 0 100 100' " +
                      "xmlns='http://www.w3.org/2000/svg' " +
                      "xmlns:xlink='http://www.w3.org/1999/xlink'>" +
                      "<title>{{operatingSystem}}</title>" +
                      "<use xlink:href='#{{operatingSystem}}' /></svg></span>";
            }
            var getSearchLinkTemplate = function () {
                return "<a href='?{{link}}'>{{title}}</a>";
            }
            return {
                "getProductTemplate": getProductTemplate,
                "getGameDetailsTemplate": getGameDetailsTemplate,
                "getRequiredProductTemplate": getRequiredProductTemplate,
                "getDLCsTemplate": getDLCsTemplate,
                "getBundleTemplate": getBundleTemplate,
                "getFileInstallerTemplate": getFileInstallerTemplate,
                "getFileExtraTemplate": getFileExtraTemplate,
                "getOperatingSystemIconTemplate": getOperatingSystemIconTemplate,
                "getScreenshotTemplate": getScreenshotTemplate,
                "getSearchLinkTemplate": getSearchLinkTemplate
            }
        }();

        var Views = function () {
            var bindTemplateToModel = function (template, model) {
                var result = template;
                for (var property in model) {
                    var replacedProperty = "{{" + property + "}}";
                    while (result.indexOf(replacedProperty) > -1)
                        result = result.replace(replacedProperty, model[property]);
                }
                return result;
            }
            var createView = function (model, viewModelProvider, templateProvider) {
                var viewModel = viewModelProvider(model);
                var template = templateProvider();
                return viewModel !== undefined ? bindTemplateToModel(template, viewModel) : "";
            }
            return {
                "createView": createView
            }
        }();

        var Images = function () {
            var getRelativeUri = function (absoluteUri) {
                var imageParts = absoluteUri.split("/");
                var imageLocalUri = imageParts[imageParts.length - 1];
                return {
                    "productImage": "_images/" + imageLocalUri + "_800.jpg",
                    "productRetinaImage": "_images/" + imageLocalUri + ".jpg",
                    "screenshot": "_screenshots/" + imageLocalUri
                }
            }
            var hideOnError = function (img) {
                if (img && img.classList) img.classList.add("hidden");
            }
            return {
                "getRelativeUri": getRelativeUri,
                "hideOnError": hideOnError
            }
        }();

        var GameDetails = function () {
            var pIndex;
            var pdIndex;
            var gdIndex;
            var gameDetailsContainer = $("gameDetailsContainer");
            var showDLC = function (id) {
                // add DLC. Showing only 1st level of DLCs to avoid recursion
                var dlcContent = [];
                var dlcProducts = [];
                var processedDlcs = [];

                var pd = pdIndex && pdIndex.getElementByKey(id);
                if (pd && pd.dlcs)
                    for (var ii = 0; ii < pd.dlcs.length; ii++) {
                        dlcProducts.push(pd.dlcs[ii]);
                        // don't add DLCs that don't have id
                        if (pd.dlcs[ii].id > 0)
                            processedDlcs.push(pd.dlcs[ii].id);
                    }

                var gd = gdIndex ? gdIndex.getElementByKey(id) : undefined;
                if (gd && gd.dlcs)
                    for (var ii = 0; ii < gd.dlcs.length; ii++) {
                        if (processedDlcs.indexOf(gd.dlcs[ii].id) > -1) continue;
                        dlcProducts.push(gd.dlcs[ii]);
                        // don't add DLCs that don't have id
                        if (gd.dlcs[ii].id > 0)
                            processedDlcs.push(gd.dlcs[ii].id);
                    }


                for (var ii = 0; ii < dlcProducts.length; ii++)
                    dlcContent.push(Views.createView(dlcProducts[ii], ViewModelProvider.getGameDetailsViewModel, Templates.getGameDetailsTemplate));

                return Views.createView(dlcContent, ViewModelProvider.getDLCsViewModel, Templates.getDLCsTemplate);
            }
            var show = function (id) {
                var product = pIndex.getElementByKey(id);
                if (!product) return;

                var markup = "";

                var htmlView = Views.createView(product, ViewModelProvider.getGameDetailsViewModel, Templates.getGameDetailsTemplate);

                markup = htmlView;
                markup += showDLC(id);

                // show bundled products
                if (Bundles.isParent(id)) {
                    var bundleContent = [],
                      bundleClass;

                    var bundle = Bundles.getBundleByParentId(id);
                    for (var ii = 0; ii < bundle.children.length; ii++) {
                        var product = pIndex.getElementByKey(bundle.children[ii]);

                        var productView = Views.createView(product, ViewModelProvider.getGameDetailsViewModel, Templates.getGameDetailsTemplate);
                        var dlcView = showDLC(bundle.children[ii]);

                        bundleContent.push(productView + dlcView);
                    }

                    var bundleView = Views.createView(bundleContent, ViewModelProvider.getBundleViewModel, Templates.getBundleTemplate);

                    markup += bundleView;
                }

                gameDetailsContainer.innerHTML = markup;
                gameDetailsContainer.classList.remove("hidden");
                gameDetailsContainer.focus();

                Mnemonics.init(gameDetailsContainer);

                // Reset scroll position between showing details for different products
                // to resolve annoying behavior where you open details and already have
                // scroller at some >0 position
                document.body.scrollTop = 0;
            }
            var close = function () {
                gameDetailsContainer.classList.add("hidden");
            }
            var init = function (pi, pdi, gdi) {
                pIndex = pi;
                pdIndex = pdi;
                gdIndex = gdi;
            }
            return {
                "init": init,
                "show": show,
                "close": close
            }
        }();

        var SearchIndex = function () {
            var pIndex, pdIndex, oIndex, uIndex, wIndex;
            var searchIndex = [];
            var indexProduct = function (p) {
                var parts = [];

                if (Bundles.isChild(p.id)) return;
                var pd = pdIndex && pdIndex.getElementByKey(p.id);
                parts.push(p.title.toLowerCase());

                if (pd) {
                    if (DLC.isDLC(pd)) parts.push("dlc");
                    if (pd.publisher) parts.push(pd.publisher.name.toLowerCase());
                    if (pd.developer) parts.push(pd.developer.name.toLowerCase());
                    if (pd.series && pd.series.name) parts.push(pd.series.name.toLowerCase());
                    if (pd.genres) {
                        for (var gg = 0; gg < pd.genres.length; gg++) {
                            parts.push(pd.genres[gg].name.toLowerCase());
                        }
                    }
                }

                if (p.worksOn.Windows) parts.push("windows");
                if (p.worksOn.Mac) parts.push("mac osx");
                if (p.worksOn.Linux) parts.push("linux");

                if (uIndex && uIndex.check(p.id)) parts.push("updated");
                if (oIndex && oIndex.check(p.id)) parts.push("owned");
                if (wIndex && wIndex.check(p.id)) parts.push("wishlisted");

                if (Bundles.isParent(p.id)) {
                    // add child items title
                    var bundle = Bundles.getBundleByParentId(p.id);
                    if (bundle)
                        for (var ii = 0; ii < bundle.children.length; ii++) {
                            var bundleChild = pIndex.getElementByKey(bundle.children[ii]);
                            if (bundleChild) parts.push(bundleChild.title.toLowerCase());
                        }
                }
                searchIndex.push(parts.join(" "));

            }
            var init = function (pi, pdi, oi, ui, wi) {
                pIndex = pi;
                pdIndex = pdi;
                oIndex = oi;
                uIndex = ui;
                wIndex = wi;
                for (var ii = 0; ii < pi.getLength() ; ii++) {
                    indexProduct(pi.getElementByIndex(ii));
                }
            };
            var match = function (text) {
                var textParts = text.split(" ");
                var matchingIds = [];
                for (var ii = 0; ii < searchIndex.length; ii++) {
                    if (!searchIndex[ii]) continue;
                    var matches = true;
                    for (var tt = 0; tt < textParts.length; tt++) {
                        if (!textParts[tt]) continue;
                        var exclude = textParts[tt].indexOf("-") === 0;
                        if (exclude && textParts[tt].length > 1) {
                            if (searchIndex[ii].indexOf(textParts[tt].substr(1)) > -1) {
                                matches = false;
                                break;
                            }
                        } else {
                            matches &= searchIndex[ii].indexOf(textParts[tt]) > -1;
                        }
                    }
                    if (matches) matchingIds.push(ii);
                }
                return matchingIds;
            };
            return {
                "init": init,
                "match": match
            }
        }();

        var Search = function () {
            var pIndex;
            var pdIndex;
            var productElements = undefined;
            var searchResults = $("searchResults");
            var productsContainer = $("productsContainer");
            var showAllResultsLink = $("showAllSearchResults");
            var resultsCount = _$(showAllResultsLink, ".resultsCount");
            var searchResultsLimit = 25;
            var search = function (text, showAllResults) {

                if (productElements === undefined) {
                    productElements = $$("#productsContainer > .product");
                }

                if (text.length > 0) {

                    searchResults.innerHTML = "";
                    productsContainer.classList.add("hidden");

                    var matchingIndexes = SearchIndex.match(text);
                    var length = showAllResults ? matchingIndexes.length : Math.min(matchingIndexes.length, searchResultsLimit);

                    if (!showAllResults && matchingIndexes.length > searchResultsLimit) {
                        showAllSearchResults.classList.remove("hidden");
                        resultsCount.textContent = matchingIndexes.length - searchResultsLimit;
                    } else {
                        showAllSearchResults.classList.add("hidden");
                    }

                    var clonedProductElements = [];

                    for (var ii = 0; ii < length; ii++) {
                        var clonedProductElement = productElements[matchingIndexes[ii]].cloneNode(true);
                        clonedProductElements.push(clonedProductElement);
                        searchResults.appendChild(clonedProductElement);
                    }

                    // GameDetails.initElements(clonedProductElements);

                    searchResults.classList.remove("hidden");

                } else {
                    showAllSearchResults.classList.add("hidden");
                    searchResults.classList.add("hidden");
                    productsContainer.classList.remove("hidden");
                    // reset location and hash when we clear out search input
                    location.hash = "";
                    location.search = "";
                }
            }
            var init = function (pi, pdi) {
                pIndex = pi;
                pdIndex = pdi;
            }
            return {
                "search": search,
                "init": init
            }
        }();

        var DLC = function () {
            var isDLC = function (pd) {
                return (pd &&
                  pd.requiredProducts !== undefined &&
                  pd.requiredProducts.length > 0);
            }
            return {
                "isDLC": isDLC
            }
        }();

        var Owned = function () {
            var pdIndex;
            var gdIndex;
            var oIndex;
            var check = function (id) {

                if (owned === undefined) return false;

                var ownedProduct = oIndex.getElementByKey(id);
                if (ownedProduct) return true;

                // if all bundled products are owned then bundle is owned
                if (Bundles.isParent(id)) {
                    var bundle = Bundles.getBundleByParentId(id);
                    var childProductsOwned = true;
                    for (var ii = 0; ii < bundle.children.length; ii++) {
                        childProductsOwned &= check(bundle.children[ii]);
                    }
                    if (childProductsOwned) return true;
                }

                var productData = pdIndex && pdIndex.getElementByKey(id);

                // return false because if that is not DLC, we should have passed the check earlier
                if (!DLC.isDLC(productData)) return false;

                for (var rp = 0; rp < productData.requiredProducts.length; rp++) {
                    var requiredProduct = productData.requiredProducts[rp].id;

                    var gameDetails = gdIndex ? gdIndex.getElementByKey(requiredProduct) : undefined;

                    if (!gameDetails ||
                      !gameDetails.dlcs) continue;

                    if (gameDetails.dlcs.length === 0) continue;

                    for (var dd = 0; dd < gameDetails.dlcs.length; dd++) {
                        var dlc = gameDetails.dlcs[dd];
                        if (dlc.title === productData.title) return true;
                    }
                }
            }
            var checkPartialOwnership = function (id) {
                if (Bundles.isParent(id) &&
                  Bundles.checkChildrenAny(id, check)) return true;
            }
            var init = function (pdi, gdi, oi) {
                pdIndex = pdi;
                gdIndex = gdi;
                oIndex = oi;
            }
            return {
                "check": check,
                "checkPartialOwnership": checkPartialOwnership,
                "init": init
            }
        }();

        var ProductClass = function () {
            var pdIndex, wIndex, uIndex;
            var getClass = function (product) {
                var productClass = [];

                if (Owned && Owned.check(product.id)) {
                    productClass.push("owned");
                } else if (owned &&
                  Owned.checkPartialOwnership &&
                  Owned.checkPartialOwnership(product.id)) {
                    productClass.push("partOwned");
                }

                if (wIndex && wIndex.check(product.id)) productClass.push("wishlisted");
                if (uIndex && uIndex.check(product.id)) productClass.push("updated");

                var pd = pdIndex && pdIndex.getElementByKey(product.id);
                if (pd && DLC.isDLC(pd)) productClass.push("dlc");

                if (Bundles.isParent(product.id)) productClass.push("bundle");

                return productClass;
            }
            var init = function (pdi, ui, wi) {
                pdIndex = pdi;
                wIndex = wi;
                uIndex = ui;
            }
            return {
                "init": init,
                "getClass": getClass
            }
        }();

        var ViewModelProvider = function () {
            var pdIndex, gdIndex, wIndex, uIndex, sIndex, wikiIndex;
            var getProductViewModel = function (product) {
                var productClass = ProductClass.getClass(product);
                return {
                    "id": product.id,
                    "productClass": productClass.join(" "),
                    "title": product.title
                };
            }
            var getRequiredProductViewModel = function (requiredProduct) {
                return requiredProduct;
            }
            var getDLCsViewModel = function (dlcs) {
                return {
                    "dlcContent": dlcs.join(""),
                    "dlcClass": dlcs.length ? "" : "hidden"
                }
            }
            var getBundleViewModel = function (bundles) {
                return {
                    "bundleContent": bundles.join(""),
                    "bundleClass": bundles.length ? "" : "hidden"
                }
            }
            var getFileViewModel = function (file) {
                if (file && !file.version) file.version = "";
                return file;
            }
            var getScreenshotModel = function (screenshot) {
                return {
                    "uri": Images.getRelativeUri(screenshot).screenshot
                }
            }
            var getSearchLinkModel = function (data) {
                return {
                    "link": escape(data),
                    "title": data
                }
            }
            var getOperatingSystemModel = function (worksOn, operatingSystem) {
                var os = "";
                if (operatingSystem === "Windows" && worksOn.Windows) {
                    os = "Windows";
                } else if (operatingSystem === "Mac" && worksOn.Mac) {
                    os = "Mac";
                } else if (operatingSystem === "Linux" && worksOn.Linux) {
                    os = "Linux";
                }
                return {
                    "operatingSystem": os
                }
            }
            var getWindowsModel = function (worksOn) {
                return getOperatingSystemModel(worksOn, "Windows");
            }
            var getMacModel = function (worksOn) {
                return getOperatingSystemModel(worksOn, "Mac");
            }
            var getLinuxModel = function (worksOn) {
                return getOperatingSystemModel(worksOn, "Linux");
            }
            var getGameDetailsViewModel = function (product) {

                if (!product) return;

                var pd = pdIndex && pdIndex.getElementByKey(product.id);
                var gd = gdIndex ? gdIndex.getElementByKey(product.id) : undefined;

                var productClass = ProductClass.getClass(product).join(" ");

                var openFolderLink, openFolderClass = "hidden";
                if (!Bundles.isParent(product.id) &&
                  Owned.check(product.id) &&
                  product.slug) {
                    openFolderLink = product.slug;
                    openFolderClass = "";
                }

                var images, productImageClass = "hidden";
                if (product.image) {
                    images = Images.getRelativeUri(product.image);
                    if (images) productImageClass = "";
                } else if (pd && pd.image) {
                    images = Images.getRelativeUri(pd.image);
                    if (images) productImageClass = "";
                }

                if (!images) {
                    images = {};
                }

                var productTitle = product.title;

                var worksOnTitle, worksOnClass = "hidden";

                if (product.worksOn) {
                    var worksOn = [];
                    var svgTemplate = Templates.getOperatingSystemIconTemplate();
                    worksOn.push(Views.createView(product.worksOn, getWindowsModel, Templates.getOperatingSystemIconTemplate));
                    worksOn.push(Views.createView(product.worksOn, getMacModel, Templates.getOperatingSystemIconTemplate));
                    worksOn.push(Views.createView(product.worksOn, getLinuxModel, Templates.getOperatingSystemIconTemplate));

                    worksOnTitle = worksOn.join(" ");
                    if (worksOnTitle) worksOnClass = "";
                }

                var publisherTitle, publisherClass = "hidden";
                if (pd &&
                  pd.publisher &&
                  pd.publisher.name) {
                    publisherTitle = Views.createView(pd.publisher.name, getSearchLinkModel, Templates.getSearchLinkTemplate);
                    if (publisherTitle) publisherClass = "";
                }

                var developerTitle, developerClass = "hidden";
                if (pd &&
                  pd.developer &&
                  pd.developer.name) {
                    developerTitle = Views.createView(pd.developer.name, getSearchLinkModel, Templates.getSearchLinkTemplate);
                    if (developerTitle) developerClass = "";
                }

                var seriesTitle, seriesClass = "hidden";

                if (pd &&
                  pd.series &&
                  pd.series.name) {
                    seriesTitle = Views.createView(pd.series.name, getSearchLinkModel, Templates.getSearchLinkTemplate);
                    if (seriesTitle) seriesClass = "";
                }

                var genresTitle, genresClass = "hidden";
                if (pd &&
                  pd.genres &&
                  pd.genres.length) {
                    var genres = [];
                    for (var ii = 0; ii < pd.genres.length; ii++) {
                        genres.push(pd.genres[ii].name);
                    }
                    genresTitle = genres.join(", ");
                    if (genresTitle) genresClass = "";
                }

                var cdKeyTitle, cdKeyClass = "hidden";
                var cdKeys = [];

                if (gd) {
                    if (gd.cdKey) {
                        cdKeys.push(gd.title + ": " + gd.cdKey);
                    }

                    if (gd.dlcs &&
                      gd.dlcs.length) {
                        for (var ii = 0; ii < gd.dlcs.length; ii++) {
                            if (gd.dlcs[ii].cdKey) {
                                cdKeys.push(gd.dlcs[ii].title + ": " + gd.dlcs[ii].cdKey);
                            }
                        }
                    }

                    cdKeyTitle = cdKeys.join(", ");

                    if (cdKeyTitle) cdKeyClass = "";
                }

                var requiredProductsTitle, requiredProductsClass = "hidden";
                if (pd &&
                  pd.requiredProducts &&
                  pd.requiredProducts.length) {
                    var requiredProducts = [];
                    for (var ii = 0; ii < pd.requiredProducts.length; ii++) {
                        var requiredProductView = Views.createView(pd.requiredProducts[ii], getRequiredProductViewModel, Templates.getRequiredProductTemplate);
                        requiredProducts.push(requiredProductView);
                    }
                    requiredProductsTitle = requiredProducts.join(", ");
                    if (requiredProductsTitle) requiredProductsClass = "";
                }

                // wikipedia

                var wikiLink, wikiClass = "hidden";
                var wiki = wikiIndex && wikiIndex.getElementByKey(product.id);
                if (wiki &&
                    wiki.url) {
                    wikiLink = wiki.url;
                    wikiClass = "";
                }

                // files

                var files = ProductFiles.getFilesForProduct(product.id);
                var installersContent = "", extrasContent = "", extrasClass = "hidden", filesClass = "hidden";
                if (files &&
                    files.length) {
                    for (var ff = 0; ff < files.length; ff++) {
                        if (files[ff].extra) {
                            var content = Views.createView(files[ff], getFileViewModel, Templates.getFileExtraTemplate);
                            extrasContent += content;
                        } else {
                            if (ProductFiles.hasBinExtension(files[ff].file)) continue;
                            var content = Views.createView(files[ff], getFileViewModel, Templates.getFileInstallerTemplate);
                            installersContent += content;
                        }
                    }
                    if (extrasContent) extrasClass = "";
                    filesClass = "";
                }

                // screenshots

                var productScreenshots = sIndex ? sIndex.getElementByKey(product.id) : undefined;
                var showScreenshotsClass = "hidden", screenshotsContent = "";
                var screenshotsCount = 0;

                if (productScreenshots &&
                    productScreenshots.Value &&
                    productScreenshots.Value.length) {
                    screenshotsCount = productScreenshots.Value.length;

                    for (var ss = 0; ss < productScreenshots.Value.length; ss++) {
                        screenshotsContent += Views.createView(productScreenshots.Value[ss], getScreenshotModel, Templates.getScreenshotTemplate);
                    }

                    showScreenshotsClass = "";
                }


                return {
                    "productTitle": productTitle,
                    "productClass": productClass,
                    "productImage": images.productImage,
                    "productRetinaImage": images.productRetinaImage,
                    "productImageClass": productImageClass,
                    "worksOnTitle": worksOnTitle,
                    "worksOnClass": worksOnClass,
                    "developerTitle": developerTitle,
                    "developerClass": developerClass,
                    "publisherTitle": publisherTitle,
                    "publisherClass": publisherClass,
                    "seriesTitle": seriesTitle,
                    "seriesClass": seriesClass,
                    "cdKeyTitle": cdKeyTitle,
                    "cdKeyClass": cdKeyClass,
                    "genresTitle": genresTitle,
                    "genresClass": genresClass,
                    "requiredProductsTitle": requiredProductsTitle,
                    "requiredProductsClass": requiredProductsClass,
                    // files
                    "filesClass": filesClass,
                    "extrasClass": extrasClass,
                    "installersContent": installersContent,
                    "extrasContent": extrasContent,
                    // screenshots
                    "showScreenshotsClass": showScreenshotsClass,
                    "screenshotsCount": screenshotsCount,
                    "screenshotsContent": screenshotsContent,
                    // wiki
                    "wikiLink": wikiLink,
                    "wikiClass": wikiClass
                }
            }
            var init = function (pdi, gdi, ui, wi, si, wikii) {
                pdIndex = pdi;
                gdIndex = gdi;
                wIndex = wi;
                uIndex = ui;
                sIndex = si;
                wikiIndex = wikii;
            }
            return {
                "init": init,
                "getProductViewModel": getProductViewModel,
                "getGameDetailsViewModel": getGameDetailsViewModel,
                "getDLCsViewModel": getDLCsViewModel,
                "getBundleViewModel": getBundleViewModel
            }
        }();

        var IndexedCollection = function () {
            var indexKeys = function (collection, getElementKey) {
                var index = [];
                collection.forEach(function (i) {
                    index[getElementKey(i)] = collection.indexOf(i);
                });
                return index;
            }
            var create = function (collection, getElementKey) {
                var index = indexKeys(collection, getElementKey);
                var getElementByKey = function (key) {
                    return collection[index[key]];
                }
                var getElementByIndex = function (itemIndex) {
                    return collection[itemIndex];
                }
                var check = function (id) {
                    if (Bundles &&
                      Bundles.isParent &&
                      Bundles.isParent(id) &&
                      Bundles.checkChildrenAny &&
                      Bundles.checkChildrenAny(id, check)) return true;

                    return getElementByKey(id) !== undefined;
                }
                return {
                    "getElementByKey": getElementByKey,
                    "getElementByIndex": getElementByIndex,
                    "check": check,
                    "getLength": function () {
                        return collection.length
                    }
                }
            }
            return {
                "create": create
            }
        }();

        var Bundles = function () {
            var parents = [];
            var children = [];
            var init = function () {
                if (!bundles || !bundles.length) return;
                for (var ii = 0; ii < bundles.length; ii++) {
                    parents.push(bundles[ii].parent);
                    for (var jj = 0; jj < bundles[ii].children.length; jj++) {
                        children.push(bundles[ii].children[jj]);
                    }
                }
            }
            var isParent = function (id) {
                return parents.indexOf(id) > -1;
            }
            var isChild = function (id) {
                return children.indexOf(id) > -1;
            }
            var getBundleByParentId = function (id) {
                for (var ii = 0; ii < bundles.length; ii++) {
                    if (bundles[ii].parent === id) {
                        return bundles[ii];
                    }
                }
            }
            var checkChildrenAny = function (id, predicate) {
                return checkChildrenInternal(id, predicate, false, function (a, b) {
                    return a | b;
                });
            }
            var checkChildrenAll = function (id, predicate) {
                return checkChildrenInternal(id, predicate, true, function (a, b) {
                    return a & b;
                });
            }
            var checkChildrenInternal = function (id, predicate, initialValue, comparison) {
                var bundle = getBundleByParentId(id);
                var result = initialValue;
                for (var ii = 0; ii < bundle.children.length; ii++) {
                    result = comparison(result, predicate(bundle.children[ii]));
                }
                return result;
            }
            return {
                "init": init,
                "isParent": isParent,
                "isChild": isChild,
                "getBundleByParentId": getBundleByParentId,
                "checkChildrenAny": checkChildrenAny,
                "checkChildrenAll": checkChildrenAll
            }
        }();

        var Info = function () {
            var infoContainer = $("infoContainer");
            var init = function () {
                var classes = [
                  "product",
                  "product owned",
                  "product owned updated",
                  "product wishlisted",
                  "product bundle",
                  "product bundle partOwned",
                  "product bundle partOwned updated",
                  "product bundle owned",
                  "product bundle owned updated",
                  "product bundle wishlisted",
                  "product dlc",
                  "product dlc owned",
                  "product dlc wishlisted"
                ];
                var titles = [
                  "Avail. products",
                  "Owned products",
                  "Upd. products",
                  "Wishlisted products",
                  "Bundles",
                  "Part. owned bundles",
                  "Upd. part. owned bundles",
                  "Owned bundles",
                  "Upd. bundles",
                  "Wishlisted bundles",
                  "DLCs",
                  "Owned DLCs",
                  "Wishlisted DLCs"
                ];

                if (classes.length !== titles.length) {
                    alert("Inconsistent information data!");
                    return;
                }

                for (var i = 0; i < classes.length; i++) {
                    var count = document.getElementsByClassName(classes[i]).length;
                    var infoEntity = document.createElement("div");
                    infoEntity.className = "info";

                    var entityClass = document.createElement("span");
                    entityClass.className = classes[i];
                    entityClass.textContent = titles[i];
                    infoEntity.appendChild(entityClass);

                    var entityCount = document.createElement("span");
                    entityCount.className = "product count";
                    entityCount.textContent = count;
                    infoEntity.appendChild(entityCount);

                    infoContainer.appendChild(infoEntity);
                }
            }
            return {
                "init": init
            }
        }();

        var ProductFiles = function () {
            var binExtension = ".bin";
            var getFilesForProduct = function (id) {
                if (!productfiles ||
                    id === 0) return;
                var files = [];
                for (var ii = 0; ii < productfiles.length; ii++)
                    if (productfiles[ii].id === id) files.push(productfiles[ii]);
                return files;
            }
            var hasBinExtension = function (filename) {
                return filename && filename.indexOf(binExtension) === filename.length - binExtension.length;
            }
            return {
                "getFilesForProduct": getFilesForProduct,
                "hasBinExtension": hasBinExtension
            }
        }();

        var NavigationController = function () {
            var productsContainer = $("productsContainer");
            var searchResults = $("searchResults");
            var searchContainer = $("searchContainer");
            var update = function () {
                if (location.hash.indexOf("#") > -1) {
                    if (location.hash === "#showAll") {
                        GameDetails.close();
                        productsContainer.classList.add("hidden");
                        searchResults.classList.remove("hidden");
                        searchContainer.classList.remove("hidden");
                        return;
                    }
                    var productId = parseInt(location.hash.substr(1));
                    if (productId !== undefined) GameDetails.show(productId);
                    productsContainer.classList.add("hidden");
                    searchResults.classList.add("hidden");
                    searchContainer.classList.add("hidden");
                } else {
                    GameDetails.close();
                    productsContainer.classList.remove("hidden");
                    searchResults.classList.remove("hidden");
                    searchContainer.classList.remove("hidden");
                }
            }
            return {
                "update": update
            }
        }();

        var Screenshots = function () {
            var show = function (element) {
                if (element &&
                    element.parentNode) {
                    var screenshotsContent = _$(element.parentNode, ".screenshots");
                    var images = _$$(screenshotsContent, "img");
                    for (var ii = 0; ii < images.length; ii++) {
                        var image = images[ii];
                        image.src = image.getAttribute("data-src");
                    }
                    screenshotsContent.classList.toggle("hidden");
                }
            }
            return {
                "show": show
            }
        }();

        var Mnemonics = function () {
            var mnemonicsVisible = false;
            var init = function (container) {

                var accessKeyElements = _$$(container, "*[accessKey]");
                for (var ii = 0; ii < accessKeyElements.length; ii++) {
                    var mnemonic = document.createElement("div");
                    mnemonic.className = "mnemonic hidden";
                    mnemonic.textContent = accessKeyElements[ii].accessKey;
                    accessKeyElements[ii].appendChild(mnemonic);
                }


                window.addEventListener("keydown", function (e) {
                    if (!e.altKey || mnemonicsVisible) return;

                    mnemonicsVisible = true;

                    var mnemonics = $$(".mnemonic");
                    for (var ii = 0; ii < mnemonics.length; ii++) {
                        mnemonics[ii].classList.remove("hidden");
                    }

                });

                window.addEventListener("keyup", function (e) {
                    if (e.keyCode !== 18) return;

                    mnemonicsVisible = false;

                    var mnemonics = $$(".mnemonic");
                    for (var ii = 0; ii < mnemonics.length; ii++) {
                        mnemonics[ii].classList.add("hidden");
                    }
                });
            }
            return {
                "init": init
            }
        }();

        document.addEventListener("DOMContentLoaded", function () {

            if (products === undefined) {
                $("errorMessage").classList.remove("hidden");
                $("searchContainer").classList.add("hidden");
                $("toggleMenu").classList.add("hidden");
                return;
            }

            var getId = function (e) {
                return e.id
            };
            var getValue = function (e) {
                return e;
            };
            var getKey = function (e) {
                return e.Key;
            }

            var start = new Date();
            var cp = [];
            var addedProducts = [];

            // first add available products...
            for (var ii = 0; ii < products.length; ii++) {
                cp.push(products[ii]);
                addedProducts.push(products[ii].id);
            }
            // ...then add owned products that are no longer available
            if (owned !== undefined) {
                for (var ii = 0; ii < owned.length; ii++) {
                    if (addedProducts.indexOf(owned[ii].id) > -1) continue;
                    cp.push(owned[ii]);
                }
            }

            var elapsed = new Date() - start;
            console.log("Combining products: " + elapsed + "ms");

            start = new Date();
            var productsIndex = IndexedCollection.create(cp, getId);
            var productsDataIndex = productsdata ? IndexedCollection.create(productsdata, getId) : undefined;
            var gameDetailsIndex = gamedetails ? IndexedCollection.create(gamedetails, getId) : undefined;
            var ownedIndex = owned ? IndexedCollection.create(owned, getId) : undefined;
            var updatedIndex = updated ? IndexedCollection.create(updated, getValue) : undefined;
            var wishlistedIndex = wishlisted ? IndexedCollection.create(wishlisted, getValue) : undefined;
            var screenshotsIndex = screenshots ? IndexedCollection.create(screenshots, getKey) : undefined;
            var wikiIndex = wikipedia ? IndexedCollection.create(wikipedia, getId) :undefined;

            ProductClass.init(productsDataIndex, updatedIndex, wishlistedIndex);
            ViewModelProvider.init(productsDataIndex, gameDetailsIndex, updatedIndex, wishlistedIndex, screenshotsIndex, wikiIndex);
            Owned.init(productsDataIndex, gameDetailsIndex, ownedIndex);
            GameDetails.init(productsIndex, productsDataIndex, gameDetailsIndex);

            elapsed = new Date() - start;
            console.log("Indexing collections: " + elapsed + "ms");

            start = new Date();
            Bundles.init();
            elapsed = new Date() - start;
            console.log("Initializing bundles: " + elapsed + "ms");

            start = new Date();
            var html = [];
            for (var ii = 0; ii < productsIndex.getLength() ; ii++) {
                var product = productsIndex.getElementByIndex(ii);

                if (Bundles.isChild(product.id)) continue;

                var view = Views.createView(product, ViewModelProvider.getProductViewModel, Templates.getProductTemplate);
                html.push(view);
            }
            elapsed = new Date() - start;
            console.log("Creating views: " + elapsed + "ms");

            var start = new Date();
            // show first N elements ASAP, others delay for a bit
            var throttle = Math.min(150, html.length);
            var initialHtml = html.slice(0, throttle).join("");
            var pContainer = document.getElementById("productsContainer");
            pContainer.innerHTML = initialHtml;

            var remainingHtml = html.slice(throttle, html.length).join("");
            requestAnimationFrame(function () {
                pContainer.innerHTML += remainingHtml;
                if (!location.search && !location.hash) pContainer.classList.remove("hidden");
                Info.init();
            });
            var elapsed = new Date() - start;
            console.log("Adding html to the DOM: " + elapsed + "ms");

            start = new Date();
            SearchIndex.init(
              productsIndex,
              productsDataIndex,
              ownedIndex,
              updatedIndex,
              wishlistedIndex);
            elapsed = new Date() - start;
            console.log("Initializing search index: " + elapsed + "ms");

            Search.init(productsIndex, productsDataIndex);
            var searchInput = $("searchInput");
            searchInput.addEventListener("input", function (e) {
                Search.search(searchInput.value.toLowerCase())
            });

            var showAllSearchResults = $("showAllSearchResults");
            showAllSearchResults.addEventListener("click", function () {
                Search.search(searchInput.value.toLowerCase(), true);
            });

            var toggleInfo = $("toggleInfo");
            toggleInfo.addEventListener("click", function (e) {
                var infoContainer = $("infoContainer");
                infoContainer.classList.toggle("hidden");
            });

            var backToTop = $("backToTop");
            backToTop.addEventListener("click", function () {
                document.body.scrollTop = 0;
            });

            var switchTheme = $("switchTheme");
            switchTheme.addEventListener("click", function (e) {
                document.body.classList.toggle("dark");
                document.body.classList.toggle("light");
            });

            window.addEventListener("hashchange", NavigationController.update);

            NavigationController.update();

            var menuContainer = $("menuContainer");
            var toggleMenu = $("toggleMenu");
            toggleMenu.addEventListener("click", function (e) {
                menuContainer.classList.toggle("hidden");
            });

            // check if we're navigating to search
            if (location.search) {
                requestAnimationFrame(function () {
                    var searchString = unescape(location.search.substr(1, location.search.length - 1));
                    searchInput.value = searchString;
                    Search.search(searchString.toLowerCase(), true);
                });
            } else if (location.hash) {
                requestAnimationFrame(NavigationController.update);
            }

            Mnemonics.init(document.body);

        });
    </script>
</body>
</html>
